(window.webpackJsonp=window.webpackJsonp||[]).push([[8,5,6],{722:function(t,e,r){"use strict";r.r(e);var n=r(711),l=r(788),o=r(232),c=r(239),d=r(51),_=r(493),f=r(720),h=r(716),m=r(717),v=r(151),y=r(235),x=r(152),k=r(784),C=r(783),w=r(786),$=r(794),S=r(787),O=r(206),R=(r(13),r(5),r(116),r(12),r(11),r(14),r(15),r(3)),j=(r(10),r(55),r(46),r(56),r(472),r(246),r(85)),L=r(248);r(474);function A(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function U(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?A(Object(source),!0).forEach((function(e){Object(R.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):A(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var T={name:"LetterSettingModal",components:{Cropper:L.a},computed:U(U({},Object(j.b)(["MediaUrl","CurrentUser"])),{},{recipient_group_list:function(){return this.$store.state.letter.recipient_group_list},recipient_list:function(){return this.$store.state.letter.recipient_list},frequent_text_list:function(){return this.$store.state.letter.frequent_text_list}}),data:function(){return{loading:!1,groups:[{id:0,title:"",recipients:[]}],texts:[{id:0,body:""}],required:[function(t){return!!t||"*"}],watch_list:{page:1,count:0,list:[]},sign:{dialog:!1,loading:!1,src:"",file:null}}},methods:{initialize:function(){var t=this;this.groups=[],this.recipient_group_list.forEach((function(e){return t.groups.push({id:e.id,title:e.title,recipients:e.recipients.map((function(t){return t.id}))})})),this.texts=[],this.watch_list={page:1,count:0,list:[]},this.frequent_text_list.forEach((function(e){return t.texts.push({id:e.id,body:e.body})})),this.$refs.form.resetValidation(),this.loadWatchList()},saveSetting:function(){var t=this;this.$refs.form.validate()?(this.loading=!0,this.$axios.$post("save-setting/",{groups:JSON.stringify(this.groups),texts:JSON.stringify(this.texts)},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.$store.commit("letter/saveSetting",e),t.$toast.success("Done"),t.$emit("closeDialog")})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.loading=!1}))):this.$toast.error("Incomplete Information`s")},loadWatchList:function(){var t=this;this.$axios.$get("watch-list/".concat(this.watch_list.page),{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.watch_list.list=e.list,t.watch_list.count=e.count}))},loadSign:function(t){t&&(this.sign.src&&URL.revokeObjectURL(this.sign.src),this.sign.src=URL.createObjectURL(t))},changeSign:function(){var t=this,canvas=this.$refs.cropper.getResult().canvas;if(canvas){var e=new FormData;canvas.toBlob((function(r){e.append("file",r,t.CurrentUser.username+".jpg"),t.sign.loading=!0,t.$axios.$post("save-user-signature/",e,{headers:{Authorization:"token "+t.$cookies.get("userToken")}}).then((function(e){t.$store.commit("setUserSignature",e),t.$toast.success("Done"),t.sign.file=null,t.sign.src="",t.sign.dialog=!1})).catch((function(){return t.$toast.error("something went wrong")})).finally((function(){return t.sign.loading=!1}))}),"image/jpeg")}}}},D=r(79),component=Object(D.a)(T,(function(){var t=this,e=t._self._c;return e(m.a,{ref:"form",on:{submit:function(e){return e.preventDefault(),t.saveSetting.apply(null,arguments)}}},[e(c.a,{attrs:{loading:t.loading}},[e(d.c,{staticClass:"teal lighten-4 font-weight-bold"},[e("small",[t._v("Configuration")])]),t._v(" "),e(d.b,[e(S.a,{attrs:{"fixed-tabs":""}},[e(w.a,{staticClass:"caption text-normal"},[t._v("Referral Groups")]),t._v(" "),e(w.a,{staticClass:"caption text-normal"},[t._v("Frequent Text`s")]),t._v(" "),e(w.a,{staticClass:"caption text-normal"},[t._v("Followed Letter`s")]),t._v(" "),e(w.a,{staticClass:"caption text-normal"},[t._v("My Sign")]),t._v(" "),e($.a,{staticClass:"pt-5 pb-2"},[e(C.a,[e("tbody",t._l(t.groups,(function(r,n){return e("tr",[e("td",[e(O.a,{staticClass:"caption",attrs:{dense:"",outlined:"","hide-details":"",color:"teal",label:"title",rules:t.required},model:{value:r.title,callback:function(e){t.$set(r,"title",e)},expression:"group.title"}})],1),t._v(" "),e("td",[e(l.a,{staticClass:"caption",attrs:{dense:"",outlined:"","hide-details":"",color:"teal",multiple:"",items:t.recipient_list.filter((function(t){return t.id>0})),"item-value":"id","item-text":"title","menu-props":"offsetY","small-chips":"",rules:t.required},scopedSlots:t._u([{key:"selection",fn:function(n){var l=n.item,o=n.index;return[0===o?e(_.a,{attrs:{small:"",color:"teal lighten-3"}},[e("span",[t._v(t._s(l.title))])]):t._e(),t._v(" "),1===o?e("span",[t._v("\n                        (+"+t._s(r.recipients.length-1)+" more)\n                      ")]):t._e()]}}],null,!0),model:{value:r.recipients,callback:function(e){t.$set(r,"recipients",e)},expression:"group.recipients"}})],1),t._v(" "),e("td",{staticClass:"text-left",attrs:{width:"40"}},[e(o.a,{attrs:{small:"",outlined:"",icon:"",color:"pink lighten-2",title:"remove"},on:{click:function(e){return t.groups.splice(n,1)}}},[e(v.a,{attrs:{small:""}},[t._v("mdi-trash-can-outline")])],1)],1)])})),0)]),t._v(" "),e(o.a,{staticClass:"subtitle-2 ma-4 text-normal",attrs:{small:"",rounded:"",color:"success"},on:{click:function(e){return t.groups.push({id:0,title:"",recipients:[]})}}},[t._v("New")])],1),t._v(" "),e($.a,{staticClass:"pt-5 pb-2"},[e(C.a,[e("tbody",t._l(t.texts,(function(text,r){return e("tr",[e("td",[e(O.a,{staticClass:"caption",attrs:{dense:"",solo:"","hide-details":"",color:"teal",label:"text",rules:t.required},model:{value:text.body,callback:function(e){t.$set(text,"body",e)},expression:"text.body"}})],1),t._v(" "),e("td",{staticClass:"text-left",attrs:{width:"40"}},[e(o.a,{staticClass:"text-normal",attrs:{small:"",outlined:"",icon:"",color:"pink lighten-2",title:"remove"},on:{click:function(e){return t.texts.splice(r,1)}}},[e(v.a,{attrs:{small:""}},[t._v("mdi-trash-can-outline")])],1)],1)])})),0)]),t._v(" "),e(o.a,{staticClass:"subtitle-2 ma-4 text-normal",attrs:{small:"",rounded:"",color:"success"},on:{click:function(e){return t.texts.push({id:0,body:""})}}},[t._v("New")])],1),t._v(" "),e($.a,{staticClass:"pt-5 pb-2"},[t.watch_list.list.length?e(y.a,{attrs:{dense:""}},t._l(t.watch_list.list,(function(r){return e(x.a,{staticClass:"rounded-10 mb-1",staticStyle:{border:"lightgray thin solid"},attrs:{dense:"",to:"/letter/ref".concat(r.id)}},[t._v(t._s(r.title))])})),1):t._e(),t._v(" "),e(k.a,{directives:[{name:"show",rawName:"v-show",value:t.watch_list.count>10,expression:"watch_list.count>10"}],attrs:{color:"teal lighten-3",length:Math.ceil(t.watch_list.count/10),"total-visible":"9"},on:{input:t.loadWatchList},model:{value:t.watch_list.page,callback:function(e){t.$set(t.watch_list,"page",e)},expression:"watch_list.page"}})],1),t._v(" "),e($.a,{staticClass:"pt-5 pb-2"},[t.CurrentUser.signature?e("div",{staticClass:"text-center"},[e("img",{staticStyle:{border:"lightgray thin solid"},attrs:{src:t.MediaUrl+t.CurrentUser.signature,alt:"",height:"200px"}}),t._v(" "),e(_.a,{attrs:{small:""}},[t._v("to change your sign photo contact administrator")])],1):e("div",[e(n.a,{staticClass:"mx-5",attrs:{type:"info",prominent:"",color:"info lighten-3"}},[e("ul",{staticClass:"mr-5 black--text"},[e("li",[t._v("you can register you signature only once")]),t._v(" "),e("li",[t._v("signature background should be white")])])]),t._v(" "),e("div",{staticClass:"text-center"},[e(o.a,{staticClass:"rounded-10 text-normal",attrs:{small:"",color:"cyan"},on:{click:function(e){t.sign.dialog=!0}}},[t._v("register")])],1),t._v(" "),e(f.a,{attrs:{width:"400"},model:{value:t.sign.dialog,callback:function(e){t.$set(t.sign,"dialog",e)},expression:"sign.dialog"}},[e(c.a,[e(d.c,{staticClass:"teal lighten-4"},[t._v("Signature Register")]),t._v(" "),e(d.b,{staticClass:"pt-6"},[t.sign.src?e("div",[e("cropper",{ref:"cropper",staticClass:"cropper",attrs:{src:t.sign.src}}),t._v(" "),e("div",{staticClass:"d-flex justify-space-between mt-5"},[e(o.a,{staticClass:"mx-auto subtitle-2 text-normal",attrs:{rounded:"",color:"teal lighten-1","min-width":"100px",loading:t.sign.loading},on:{click:function(e){t.sign.file=null,t.sign.src=""}}},[t._v("Change Image")]),t._v(" "),e(o.a,{staticClass:"mx-auto subtitle-2 text-normal",attrs:{rounded:"",color:"teal lighten-1","min-width":"100px",loading:t.sign.loading},on:{click:t.changeSign}},[t._v("Crop and Save")])],1)],1):e(h.a,{attrs:{accept:"image/*",placeholder:"Load Image",outlined:"",dense:""},on:{change:function(e){return t.loadSign(e)}}})],1)],1)],1)],1)])],1)],1),t._v(" "),e(d.a,{staticClass:"teal lighten-4 py-4"},[e(o.a,{staticClass:"mx-auto text-normal",attrs:{rounded:"",dark:"",color:"teal lighten-1",type:"submit",title:"Save Changes"}},[e(v.a,{attrs:{dark:""}},[t._v("mdi-content-save-outline")])],1)],1)],1)],1)}),[],!1,null,"54aa1864",null);e.default=component.exports},723:function(t,e,r){"use strict";r.r(e);var n=r(232),l=r(793),o=r(239),c=r(51),d=r(792),_=r(493),f=r(720),h=r(705),m=r(716),v=r(151),y=r(235),x=r(152),k=r(704),C=r(785),w=r(782),$=(r(5),r(10),r(104),r(116),r(36),r(12),r(11),r(14),r(15),r(3)),S=(r(13),r(85));function O(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function R(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?O(Object(source),!0).forEach((function(e){Object($.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):O(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var j={name:"ReferModal",props:["ids","is_in_inbox","reply_me"],computed:R(R({},Object(S.b)([""])),{},{recipient_list:function(){return this.$store.state.letter.recipient_list},frequent_text_list:function(){return this.$store.state.letter.frequent_text_list}}),data:function(){return{loading:!1,refers:[{recipients:[],transcripts:[],files:[],body:"",urgency:"normal",confidential:!1}],show_transcript:!1,frequent:{show:!1,index:0,x:0,y:0},dialog_setting:!1}},mounted:function(){var t=this;this.recipient_list.length||this.$axios.$get("recipient-list",{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){return t.$store.commit("letter/setRecipientList",e)})),this.frequent_text_list.length||this.$axios.$get("frequent-text-list/",{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){return t.$store.commit("letter/setFrequentTextList",e)})),this.$store.state.letter.recipient_group_list.length||this.$axios.$get("recipient-group-list/",{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){return t.$store.commit("letter/setRecipientGroupList",e)}))},methods:{initialize:function(){this.loading=!1,this.refers=[{recipients:[],transcripts:[],files:[],body:"",urgency:"normal",confidential:!1}],this.show_transcript=!1,this.frequent={show:!1,index:0,x:0,y:0}},sendRefer:function(t){var e=this;if(this.refers.filter((function(t){return!t.recipients.length})).length)this.$toast.error("Specify at least one recipient");else{this.loading=!0;var r=new FormData;this.ids.forEach((function(t){return r.append("parents",t)})),r.append("then",t),this.reply_me&&r.append("reply_me",!0),this.refers.forEach((function(t,e){r.append("refer"+e,JSON.stringify(t)),t.files.forEach((function(t){return r.append("files"+e,t,t.name)}))})),this.$axios.$post("add-refer/",r,{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(r){e.$toast.success("Referral registered"),!t&&e.reply_me&&e.$store.commit("letter/setLetterRefers",r),e.$emit("closeModal",t)})).catch((function(t){return e.$toast.error(t.response.data.detail)})).finally((function(){return e.loading=!1}))}}}},L=r(79),component=Object(L.a)(j,(function(){var t=this,e=t._self._c;return e(o.a,{staticClass:"rounded-10"},[e(c.c,{staticClass:"teal lighten-4 font-weight-bold py-2 pl-3"},[e("small",[t._v("Refer")]),t._v(" "),e(n.a,{directives:[{name:"show",rawName:"v-show",value:!t.show_transcript,expression:"!show_transcript"}],staticClass:"ml-auto rounded-lg text-normal",attrs:{"x-small":"",outlined:"",color:"teal",disabled:t.loading},on:{click:function(e){t.show_transcript=!0}}},[t._v("add transcript")]),t._v(" "),e(n.a,{directives:[{name:"show",rawName:"v-show",value:t.show_transcript,expression:"show_transcript"}],staticClass:"ml-auto rounded-lg text-normal",attrs:{"x-small":"",outlined:"",color:"teal",disabled:t.loading},on:{click:function(e){t.show_transcript=!1,t.refers.forEach((function(t){return t.transcripts=[]}))}}},[t._v("remove transcript")]),t._v(" "),e(n.a,{staticClass:"ml-2",attrs:{"x-small":"",icon:"",color:"teal",title:"close"},on:{click:function(e){return t.$emit("closeModal",null)}}},[e(v.a,{attrs:{small:""}},[t._v("mdi-close")])],1)],1),t._v(" "),e(c.b,{staticClass:"pt-4"},[t._l(t.refers,(function(r,c){return e(o.a,{staticClass:"pa-1 mb-3 rounded-lg",staticStyle:{border:"lightgrey thin solid !important"},attrs:{flat:"",color:"grey lighten-3"}},[e(k.a,{attrs:{"offset-y":"",transition:"scale-transition",origin:"top center","close-on-content-click":!1,disabled:t.loading},scopedSlots:t._u([{key:"activator",fn:function(n){var l=n.on;return[e(o.a,t._g({staticClass:"mb-2 rounded-lg px-2 d-flex",attrs:{outlined:""}},l),[e(v.a,{attrs:{color:"teal"}},[t._v("mdi-account-check-outline mdi-18px")]),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!r.recipients.length,expression:"!ref.recipients.length"}],staticClass:"caption grey--text ml-1"},[t._v("Receiver")]),t._v(" "),e("div",{staticStyle:{"padding-bottom":"2px"}},t._l(r.recipients,(function(r){return e(w.a,{key:r.id,attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(n){var l=n.on;return[e(_.a,t._g({staticClass:"ml-1",attrs:{"x-small":"",color:r>0?"teal lighten-4":"orange lighten-3"}},l),[t._v(t._s(t.recipient_list.find((function(t){return t.id===r})).title))])]}}],null,!0)},[t._v(" "),e("small",[t._v(t._s(t.recipient_list.find((function(t){return t.id===r})).subtitle))])])})),1)],1)]}}],null,!0)},[t._v(" "),e(y.a,{attrs:{dense:""}},t._l(t.recipient_list,(function(n){return e(x.a,{key:n.id},[e(d.a,{staticClass:"subtitle-2",attrs:{dense:"","hide-details":"",value:n.id,color:"teal"},model:{value:r.recipients,callback:function(e){t.$set(r,"recipients",e)},expression:"ref.recipients"}}),t._v(" "),e("div",{staticClass:"caption mt-2"},[t._v(t._s(n.title)+" "),e("small",{staticClass:"grey--text"},[t._v(" - "+t._s(n.subtitle))])])],1)})),1)],1),t._v(" "),t.show_transcript?e(k.a,{attrs:{"offset-y":"",transition:"scale-transition",origin:"top center","close-on-content-click":!1,disabled:t.loading},scopedSlots:t._u([{key:"activator",fn:function(n){var l=n.on;return[e(o.a,t._g({staticClass:"mb-2 rounded-lg px-2 d-flex",attrs:{outlined:""}},l),[e(v.a,{attrs:{color:"teal"}},[t._v("mdi-account-check-outline mdi-18px")]),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!r.transcripts.length,expression:"!ref.transcripts.length"}],staticClass:"caption grey--text ml-1"},[t._v("Transcript")]),t._v(" "),e("div",{staticStyle:{"padding-bottom":"2px"}},t._l(r.transcripts,(function(r){return e(w.a,{key:r.id,attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(n){var l=n.on;return[e(_.a,t._g({staticClass:"ml-1",attrs:{"x-small":"",color:r>0?"teal lighten-4":"orange lighten-3"}},l),[t._v(t._s(t.recipient_list.find((function(t){return t.id===r})).title))])]}}],null,!0)},[t._v(" "),e("small",[t._v(t._s(t.recipient_list.find((function(t){return t.id===r})).subtitle))])])})),1)],1)]}}],null,!0)},[t._v(" "),e(y.a,{attrs:{dense:""}},t._l(t.recipient_list,(function(n){return e(x.a,{key:n.id},[e(d.a,{staticClass:"subtitle-2",attrs:{dense:"","hide-details":"",value:n.id,color:"teal"},model:{value:r.transcripts,callback:function(e){t.$set(r,"transcripts",e)},expression:"ref.transcripts"}}),t._v(" "),e("div",{staticClass:"caption mt-2"},[t._v(t._s(n.title)+" "),e("small",{staticClass:"grey--text"},[t._v(" - "+t._s(n.subtitle))])])],1)})),1)],1):t._e(),t._v(" "),e("div",{staticClass:"d-flex"},[e("div",{staticClass:"flex-fill"},[e(C.a,{staticClass:"caption mb-1",attrs:{dense:"",flat:"",solo:"",rows:2,"hide-details":"",color:"teal",disabled:t.loading},on:{contextmenu:function(e){return e.preventDefault(),function(e){t.frequent.show=!1,t.frequent.index=c,t.frequent.x=e.clientX,t.frequent.y=e.clientY,t.frequent.show=!0}.apply(null,arguments)}},model:{value:r.body,callback:function(e){t.$set(r,"body",e)},expression:"ref.body"}}),t._v(" "),e("div",{staticClass:"d-flex justify-space-between"},[e(_.a,{attrs:{"x-small":""}},[t._v("right click, for insert frequent text`s")]),t._v(" "),c?e(n.a,{staticClass:"rounded-lg text-normal",attrs:{"x-small":"",text:"",outlined:"",color:"pink",disabled:t.loading},on:{click:function(e){return t.refers.splice(c,1)}}},[e(v.a,{attrs:{small:""}},[t._v("mdi-trash-can-outline")]),t._v("\n                Remove Refer\n              ")],1):t._e()],1)],1),t._v(" "),e("div",{staticClass:"pl-2 d-flex flex-column"},[e(l.a,{attrs:{color:"immediate"===r.urgency?"pink":"urgent"===r.urgency?"orange":"teal",dense:"",mandatory:""},model:{value:r.urgency,callback:function(e){t.$set(r,"urgency",e)},expression:"ref.urgency"}},[e(n.a,{staticClass:"px-1 text-normal",attrs:{"x-small":"",disabled:t.loading,value:"normal"}},[t._v("normal")]),t._v(" "),e(n.a,{staticClass:"px-1 text-normal",attrs:{"x-small":"",disabled:t.loading,value:"urgent"}},[t._v("urgent")]),t._v(" "),e(n.a,{staticClass:"px-1 text-normal",attrs:{"x-small":"",disabled:t.loading,value:"immediate"}},[t._v("immediate")])],1),t._v(" "),e(n.a,{staticClass:"rounded-lg mt-2 text-normal",attrs:{"x-small":"",outlined:"",color:r.confidential?"pink lighten-2":"grey",disabled:t.loading},on:{click:function(t){r.confidential=!r.confidential}}},[r.confidential?e(v.a,{attrs:{small:""}},[t._v("mdi-check")]):t._e(),t._v("\n              confidential\n            ")],1),t._v(" "),e(n.a,{staticClass:"rounded-lg mt-2 text-normal",attrs:{"x-small":"",outlined:"",color:"grey",disabled:t.loading},on:{click:function(e){t.$refs["file_selector".concat(c)][0].$refs.input.click()}}},[t._v("Appendix")]),t._v(" "),e(m.a,{ref:"file_selector".concat(c),refInFor:!0,staticStyle:{display:"none"},attrs:{multiple:""},on:{change:function(t){}},model:{value:r.files,callback:function(e){t.$set(r,"files",e)},expression:"ref.files"}}),t._v(" "),t._l(r.files,(function(n,l){return e("div",[e(_.a,{staticClass:"px-1",staticStyle:{"max-width":"90px"},attrs:{"x-small":""}},[t._v(t._s(n.name))]),t._v(" "),t.loading?t._e():e(v.a,{staticStyle:{cursor:"pointer"},attrs:{"x-small":"",color:"pink lighten-2"},on:{click:function(t){return r.files.splice(c,1)}}},[t._v("mdi-trash-can-outline")])],1)}))],2)])],1)})),t._v(" "),e(n.a,{staticClass:"rounded-lg text-normal",attrs:{"x-small":"",text:"",outlined:"",color:"teal",disabled:t.loading},on:{click:function(e){return t.refers.push({recipients:[],transcripts:[],files:[],body:"",urgency:"Add Refer",confidential:!1})}}},[e(v.a,{attrs:{small:""}},[t._v("mdi-plus")]),t._v("\n        Add Refer\n      ")],1)],2),t._v(" "),e(c.a,{staticClass:"teal lighten-4 d-flex justify-space-around py-4"},[e(n.a,{staticClass:"mx-auto caption rounded-lg text-normal",attrs:{small:"",dark:"",color:"teal lighten-1",width:"140",loading:t.loading},on:{click:function(e){return t.sendRefer("inbox")}}},[t._v("Send")]),t._v(" "),t.is_in_inbox?e(n.a,{staticClass:"mx-auto caption rounded-lg text-normal",attrs:{small:"",dark:"",color:"teal lighten-1",width:"140",loading:t.loading},on:{click:function(e){return t.sendRefer("archive")}}},[t._v("Send & Archive")]):t._e(),t._v(" "),t.is_in_inbox?e(n.a,{staticClass:"mx-auto caption rounded-lg text-normal",attrs:{small:"",dark:"",color:"teal lighten-1",width:"140",loading:t.loading},on:{click:function(e){return t.sendRefer("trash")}}},[t._v("Send & Remove")]):t._e()],1),t._v(" "),e(k.a,{attrs:{"position-x":t.frequent.x,"position-y":t.frequent.y,absolute:"","offset-y":""},model:{value:t.frequent.show,callback:function(e){t.$set(t.frequent,"show",e)},expression:"frequent.show"}},[e(y.a,{attrs:{dense:""}},[t._l(t.frequent_text_list,(function(text){return e(x.a,{staticClass:"caption",attrs:{link:""},on:{click:function(e){t.refers[t.frequent.index].body=text.body}}},[t._v(t._s(text.body))])})),t._v(" "),e(h.a),t._v(" "),e(x.a,{staticClass:"caption",attrs:{link:""},on:{click:function(e){t.dialog_setting=!0,t.$nextTick((function(){return t.$refs.letter_setting.initialize()}))}}},[e(v.a,{staticClass:"mr-2",attrs:{small:""}},[t._v("mdi-cog")]),t._v("\n          Configurations\n        ")],1)],2)],1),t._v(" "),e(f.a,{attrs:{width:"800"},model:{value:t.dialog_setting,callback:function(e){t.dialog_setting=e},expression:"dialog_setting"}},[e("LetterSettingModal",{ref:"letter_setting",on:{closeDialog:function(e){t.dialog_setting=!1}}})],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{LetterSettingModal:r(722).default})},743:function(t,e,r){t.exports=r.p+"img/l10.e0945ad.png"},790:function(t,e,r){"use strict";r.r(e);var n=r(232),l=r(793),o=r(239),c=r(51),d=r(493),_=r(780),f=r(720),h=r(716),m=r(151),v=r(784),y=r(779),x=r(783),k=r(781),C=r(713),w=r(206),$=r(782),S=(r(37),r(78),r(737),r(12),r(11),r(13),r(14),r(10),r(15),r(3)),O=(r(55),r(25),r(5),r(46),r(56),r(472),r(246),r(32),r(44),r(85)),R=r(751),j=r(723),L=r(310),A=r.n(L),U=(r(496),r(733)),T=r.n(U);function D(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function z(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?D(Object(source),!0).forEach((function(e){Object(S.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):D(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var P={name:"_pk",components:{ReferModal:j.default,vh2p:R.a,OrgChart:A.a},computed:z(z({},Object(O.b)(["MediaUrl","CurrentUser"])),{},{letter:function(){return this.$store.state.letter.letter},my_refer:function(){if("ref"!==this.$route.params.pk.substr(0,3))return null;var i=this.letter.refers.map((function(t){return t.id})).indexOf(Number(this.$route.params.pk.substr(3)));return this.letter.refers[i]}}),data:function(){return{loading:!1,processing:!1,pdf_src:"",dialog_refer:!1,dialog_refer_tree:!1,refer_tree:{},editing:{dialog:!1,loading:!1,type:"text",title:"",body:"",file:null,external_sender:""},editor:T.a,editorConfig:{fontSize:{options:[9,10,11,12,13,14,15,16,17,18,19,20],supportAllValues:!0},toolbar:{items:["heading","|","fontSize","fontColor","fontBackgroundColor","|","bold","italic","|","alignment","numberedList","bulletedList","|","outdent","indent","|","link","insertTable","|","undo","redo"],shouldNotGroupWhenFull:!0}},new_appendix:{file:null,loading:!1},related_letters:{dialog:!1,loading:!1,q:"",page:1,list:[]}}},methods:{loadLetter:function(){var t=this;this.loading=!0,this.$axios.$get("letter-detail/".concat(this.$route.params.pk),{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.$store.commit("letter/setLetter",{letter:e.letter,ref:"ref"===t.$route.params.pk.substr(0,3)?Number(t.$route.params.pk.substr(3)):0}),t.$store.commit("setCurrentUserLetterCount",e.letter_count),e.letter.pdf_url&&t.$axios.$get("letter-media/letter/".concat(e.letter.id),{headers:{Authorization:"token "+t.$cookies.get("userToken")},responseType:"blob"}).then((function(e){return t.pdf_src=window.URL.createObjectURL(new Blob([e],{type:"application/pdf"}))})).catch((function(){return t.$toast.error("file not found")}))})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.loading=!1}))},mediaDownload:function(table,t,title){var e=this;this.loading||(this.loading=!0,this.$axios.$get("letter-media/".concat(table,"/").concat(t),{headers:{Authorization:"token "+this.$cookies.get("userToken")},responseType:"blob"}).then((function(t){var e=window.URL.createObjectURL(new Blob([t])),r=document.createElement("a");r.href=e,r.setAttribute("download",title),r.click()})).catch((function(){return e.$toast.error("file not found")})).finally((function(){return e.loading=!1})))},changeReferStatus:function(t,e){var r=this;this.loading||(this.loading=!0,this.$axios.$post("change-refer-status/",{field:t,value:e,ids:[this.my_refer.id]},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(){r.$store.commit("letter/setMenuPage",0),r.$router.push("/letter"),r.$toast.success("referral ".concat("trashed"===t?e?"removed":"recovered":e?"archived":"recovered"))})).catch((function(t){return r.$toast.error(t.response.data.detail)})).finally((function(){return r.loading=!1})))},closeReferModal:function(t){this.dialog_refer=!1,t&&(["archive","trash"].includes(t)&&this.$store.commit("letter/removeLetters",this.selected),this.selected=[])},loadLetterReferTree:function(){var t=this;this.processing||(this.processing=!0,this.$axios.$get("letter-refer-tree/"+this.letter.id,{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.refer_tree=e,t.dialog_refer_tree=!0})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.processing=!1})))},watchLetter:function(){var t=this;this.processing||(this.processing=!0,this.$axios.$post("watch-letter/",{id:this.letter.id,watch:!this.letter.watch},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.$store.commit("letter/setLetterWatch",e.watch),e.watch?t.$toast.info("watching enabled, you will be notified on any new referral of this letter"):t.$toast.info("watching disabled")})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.processing=!1})))},onReady:function(t){t.ui.getEditableElement().parentElement.insertBefore(t.ui.view.toolbar.element,t.ui.getEditableElement())},saveLetter:function(){var t=this;if(this.editing.title)if("text"!==this.editing.type||this.editing.body)if("pdf"!==this.editing.type||this.editing.file&&this.editing.external_sender){this.editing.loading=!0;var e=new FormData;e.append("id",this.letter.id),e.append("title",this.editing.title),"text"===this.editing.type?e.append("body",this.editing.body):(e.append("file",this.editing.file),e.append("external_sender",this.editing.external_sender)),this.$axios.$post("save-letter/",e,{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.$store.commit("letter/setLetter",{letter:e,ref:"ref"===t.$route.params.pk.substr(0,3)?Number(t.$route.params.pk.substr(3)):0}),t.editing.dialog=!1,"pdf"===t.editing.type&&t.$axios.$get("letter-media/letter/".concat(t.letter.id),{headers:{Authorization:"token "+t.$cookies.get("userToken")},responseType:"blob"}).then((function(e){return t.pdf_src=window.URL.createObjectURL(new Blob([e],{type:"application/pdf"}))})).catch((function(){return t.$toast.error("file not found")}))})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.editing.loading=!1}))}else this.$toast.error("Please specify file and sender");else this.$toast.error("Please write something...");else this.$toast.error("Please enter letter title")},signLetter:function(){var t=this;confirm("after signed letter wont be editable, sign it?")&&this.$axios.$post("sign-letter/",{id:this.letter.id},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){t.$store.commit("letter/signLetter",z({id:t.letter.id},e)),t.$toast.success("Done")})).catch((function(e){return t.$toast.error(e.response.data.detail)}))},addAppendix:function(){var t=this;if(this.new_appendix.file){this.new_appendix.loading=!0;var e=new FormData;e.append("id",this.letter.id),e.append("file",this.new_appendix.file),this.$axios.$post("letter-appendix-add/",e,{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(e){return t.$store.commit("letter/addLetterAppendix",e)})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.new_appendix.loading=!1}))}},removeAppendix:function(t){var e=this;confirm("Can`t be recovered, remove file?")&&(this.new_appendix.loading=!0,this.$axios.$post("letter-appendix-remove/",{id:t},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(){return e.$store.commit("letter/removeLetterAppendix",t)})).catch((function(t){return e.$toast.error(t.response.data.detail)})).finally((function(){return e.new_appendix.loading=!1})))},relatedLetterSearch:function(){var t=this;this.related_letters.loading||(this.related_letters.loading=!0,this.$axios.$get("related-letter-search/",{headers:{Authorization:"token "+this.$cookies.get("userToken")},params:{q:this.related_letters.q,page:this.related_letters.page}}).then((function(e){t.related_letters.list=e.list,t.related_letters.count=e.count,t.related_letters.page=e.page})).catch((function(e){return t.$toast.error(e.response.data.detail)})).finally((function(){return t.related_letters.loading=!1})))},addRelation:function(t){var e=this;this.related_letters.loading||(this.related_letters.loading=!0,this.$axios.$post("letter-relation-add/",{letter:this.letter.id,relation:t},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(t){e.$store.commit("letter/addLetterRelation",t),e.related_letters.dialog=!1})).catch((function(t){return e.$toast.error(t.response.data.detail)})).finally((function(){return e.related_letters.loading=!1})))},removeRelation:function(t){var e=this;this.related_letters.loading=!0,this.$axios.$post("letter-relation-remove/",{letter:this.letter.id,relation:t},{headers:{Authorization:"token "+this.$cookies.get("userToken")}}).then((function(){return e.$store.commit("letter/removeLetterRelation",t)})).catch((function(t){return e.$toast.error(t.response.data.detail)})).finally((function(){return e.related_letters.loading=!1}))}},watch:{"$route.params.pk":{handler:function(){this.loadLetter()},immediate:!0}}},M=r(79),component=Object(M.a)(P,(function(){var t=this,e=t._self._c;return e("div",[t.loading?e(o.a,{staticClass:"rounded-15 pa-5",attrs:{elevation:"10"}},[e(y.a,[e(_.a,{attrs:{cols:"12",md:"8"}},[e(k.a,{attrs:{type:"card"}})],1),t._v(" "),e(_.a,{attrs:{cols:"12",md:"4"}},[e(k.a,{attrs:{type:"card-heading"}}),t._v(" "),e(k.a,{attrs:{type:"card-heading"}})],1)],1)],1):e(o.a,{staticClass:"rounded-15 pa-5",attrs:{elevation:"10",loading:t.loading,color:"grey lighten-5"}},[e(c.c,{staticClass:"teal lighten-4 font-weight-bold py-2"},[e("div",{staticClass:"d-flex flex-fill"},[e(n.a,{staticClass:"mr-2",attrs:{small:"",icon:"",outlined:"",color:"info",to:"/"}},[e(m.a,{attrs:{small:""}},[t._v("mdi-arrow-left-thick")])],1),t._v(" "),e("small",[t._v(t._s(t.letter.id)+" - "+t._s(t.letter.title))]),t._v(" "),e(C.a),t._v(" "),t.my_refer?e("div",[t.letter.user?t._e():e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"info"},on:{click:function(e){t.editing={dialog:!0,loading:!1,type:t.letter.pdf_url?"pdf":"text",title:t.letter.title,body:t.letter.body,file:null,external_sender:""}}}},[t._v("Edit"),e(m.a,{staticClass:"ml-2",attrs:{small:""}},[t._v("mdi-pencil")])],1),t._v(" "),t.letter.user?t._e():e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"info"},on:{click:t.signLetter}},[t._v("Sign"),e(m.a,{staticClass:"ml-2",attrs:{small:""}},[t._v("mdi-signature-freehand")])],1),t._v(" "),e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"info"},on:{click:function(e){t.dialog_refer=!0,t.$nextTick((function(){return t.$refs.refer_modal.initialize()}))}}},[t._v("Refer"),e(m.a,{staticClass:"ml-2",attrs:{small:""}},[t._v("mdi-reply mdi-flip-h")])],1),t._v(" "),t.my_refer.user_id!==t.CurrentUser.id||t.my_refer.trashed||t.my_refer.archived?t._e():e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"teal"},on:{click:function(e){return t.changeReferStatus("archived",!0)}}},[t._v("Archive"),e(m.a,{staticClass:"ml-1",attrs:{small:""}},[t._v("mdi-archive-outline")])],1),t._v(" "),t.my_refer.user_id===t.CurrentUser.id&&!t.my_refer.trashed&&t.my_refer.archived?e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"green"},on:{click:function(e){return t.changeReferStatus("archived",!1)}}},[t._v("Recycle"),e(m.a,{staticClass:"ml-2",attrs:{small:""}},[t._v("mdi-archive-arrow-up-outline")])],1):t._e(),t._v(" "),t.my_refer.user_id!==t.CurrentUser.id||t.my_refer.trashed?t._e():e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"pink lighten-2"},on:{click:function(e){return t.changeReferStatus("trashed",!0)}}},[t._v("Remove"),e(m.a,{staticClass:"ml-1",attrs:{small:""}},[t._v("mdi-trash-can-outline")])],1),t._v(" "),t.my_refer.user_id===t.CurrentUser.id&&t.my_refer.trashed?e(n.a,{staticClass:"caption text-normal",attrs:{small:"",outlined:"",rounded:"",color:"green"},on:{click:function(e){return t.changeReferStatus("trashed",!1)}}},[t._v("Recycle"),e(m.a,{staticClass:"ml-2",attrs:{small:""}},[t._v("mdi-backup-restore")])],1):t._e()],1):t._e(),t._v(" "),e($.a,{attrs:{top:"",color:"teal lighten-2"},scopedSlots:t._u([{key:"activator",fn:function(r){var l=r.on;return[t.letter.user?e(n.a,t._g({staticClass:"ml-2 my-auto",attrs:{small:"",icon:"",outlined:"",color:t.letter.watch?"teal":"grey",loading:t.processing},on:{click:t.watchLetter}},l),[e(m.a,{attrs:{small:""}},[t._v(t._s(t.letter.watch?"mdi-eye":"mdi-eye-off"))])],1):t._e()]}}])},[t._v(" "),e("small",[t._v("Watch Letter")])]),t._v(" "),t.letter.pdf_url?t._e():e(n.a,{staticClass:"ml-2 my-auto",attrs:{small:"",icon:"",outlined:"",color:"teal"},on:{click:function(e){return t.$refs.vh2p.generatePdf()}}},[e(m.a,{attrs:{small:""}},[t._v("mdi-printer")])],1)],1)]),t._v(" "),e(c.b,{staticClass:"pt-5"},[e(y.a,[e(_.a,{attrs:{cols:"12",md:"8"}},[t.letter.pdf_url?e("iframe",{staticClass:"rounded-lg",staticStyle:{border:"lightgrey thin solid","min-height":"400px","max-height":"700px",width:"100%","overflow-y":"auto"},attrs:{src:t.pdf_src}}):e("div",{staticClass:"rounded-lg pa-3",staticStyle:{border:"lightgrey thin solid","min-height":"400px","max-height":"700px","background-color":"white","overflow-y":"auto"}},[e("div",{staticClass:"black--text",staticStyle:{"line-height":"30px"},domProps:{innerHTML:t._s(t.letter.body)}}),t._v(" "),e("div",{staticClass:"d-flex mt-10"},[e("div",{staticClass:"flex-fill"}),t._v(" "),e("div",{staticClass:"px-10 d-flex flex-column caption"},[e("b",{staticClass:"mx-auto"},[t._v(t._s(t.letter.user))]),t._v(" "),e("span",{staticClass:"mx-auto"},[t._v(t._s(t.letter.post))]),t._v(" "),t.letter.sign_url?e("img",{staticClass:"mx-auto",staticStyle:{height:"80px"},attrs:{src:t.MediaUrl+t.letter.sign_url,alt:"sign"}}):e(d.a,{staticClass:"mx-auto my-2",attrs:{"x-small":""}},[t._v("No Sign")])],1)])]),t._v(" "),e("table",{staticStyle:{width:"100%"}},[t.letter.appendices.length||!t.letter.user?e("tr",[e("td",{staticClass:"caption py-1 pr-1",staticStyle:{width:"1%"}},[e("small",[t._v("Appendices:")])]),t._v(" "),e("td",t._l(t.letter.appendices,(function(r){return e("span",{staticClass:"ml-2"},[e(n.a,{attrs:{"x-small":"",color:"cyan lighten-3",rounded:""},on:{click:function(e){t.mediaDownload("letter-appendix",r.id,r.file_url.substr(13))}}},[t._v(t._s(r.file_url.substr(13)))]),t._v(" "),t.letter.user?t._e():e(n.a,{staticStyle:{"margin-right":"-5px"},attrs:{"x-small":"",icon:"",color:"pink lighten-3",title:"Remove"},on:{click:function(e){return t.removeAppendix(r.id)}}},[e(m.a,{attrs:{"x-small":""}},[t._v("mdi-trash-can-outline")])],1)],1)})),0),t._v(" "),e("td",{staticStyle:{width:"1%"}},[e(h.a,{ref:"file_selector",staticStyle:{display:"none"},on:{change:t.addAppendix},model:{value:t.new_appendix.file,callback:function(e){t.$set(t.new_appendix,"file",e)},expression:"new_appendix.file"}}),t._v(" "),t.letter.user?t._e():e(n.a,{staticClass:"rounded-lg",attrs:{"x-small":"",color:"green lighten-3",width:"100"},on:{click:function(e){t.new_appendix.file=null,t.$refs.file_selector.$refs.input.click()}}},[t._v("Add Appendix")])],1)]):t._e(),t._v(" "),t.letter.relations.length||!t.letter.user?e("tr",[e("td",{staticClass:"caption py-1 pr-1",staticStyle:{width:"1%"}},[e("small",[t._v("Relations:")])]),t._v(" "),e("td",t._l(t.letter.relations,(function(r){return e("span",{staticClass:"ml-2"},[e(n.a,{attrs:{"x-small":"",color:"cyan lighten-3",rounded:"",to:"/letter/".concat(r.id)}},[t._v(t._s(r.title))]),t._v(" "),t.letter.user?t._e():e(n.a,{staticStyle:{"margin-right":"-5px"},attrs:{"x-small":"",icon:"",color:"pink lighten-3",title:"Remove"},on:{click:function(e){return t.removeRelation(r.id)}}},[e(m.a,{attrs:{"x-small":""}},[t._v("mdi-trash-can-outline")])],1)],1)})),0),t._v(" "),e("td",[t.letter.user?t._e():e(n.a,{staticClass:"rounded-lg",attrs:{"x-small":"",color:"green lighten-3",width:"100",loading:t.related_letters.loading},on:{click:function(e){t.related_letters={dialog:!0,loading:!1,q:"",page:1,list:[]}}}},[t._v("Add Relation")])],1)]):t._e()])]),t._v(" "),e(_.a,{staticClass:"px-0",attrs:{cols:"12",md:"4"}},[t.my_refer?e("table",{staticStyle:{width:"100%"}},[t.my_refer.user_id===t.CurrentUser.id?e("tr",[e("td",{staticClass:"caption py-1 pr-1",staticStyle:{width:"1%"}},[t._v("from:")]),t._v(" "),e("td",{staticClass:"caption font-weight-bold"},[t._v(t._s(t.my_refer.sender_user)+" - "+t._s(t.my_refer.sender_post))])]):e("tr",[e("td",{staticClass:"caption py-1 pr-1",staticStyle:{width:"1%"}},[t._v("to:")]),t._v(" "),e("td",{staticClass:"caption font-weight-bold"},[t._v(t._s(t.my_refer.user)+" - "+t._s(t.my_refer.post))])]),t._v(" "),e("tr",[e("td",{staticClass:"caption py-1 pr-1"},[t._v("time:")]),t._v(" "),e("td",{staticClass:"caption font-weight-bold"},[t._v(t._s(t.my_refer.time.substr(0,10))+" "+t._s(t.my_refer.time.substr(11,5)))])]),t._v(" "),t.my_refer.transcript||t.my_refer.confidential||"normal"!==t.my_refer.urgency?e("tr",[e("td",{staticClass:"caption py-1 pr-1"},[e("small",[t._v("tag")])]),t._v(" "),e("td",[t.my_refer.confidential?e(d.a,{staticClass:"px-2",attrs:{"x-small":"",dark:"",color:"pink lighten-2"}},[t._v("confidential")]):t._e(),t._v(" "),"immediate"===t.my_refer.urgency?e(d.a,{attrs:{"x-small":"",dark:"",color:"pink lighten-2"}},[t._v("immediate")]):"urgent"===t.my_refer.urgency?e(d.a,{staticClass:"px-2",attrs:{"x-small":"",dark:"",color:"orange lighten-1"}},[t._v("urgent")]):t._e(),t._v(" "),t.my_refer.transcript?e(d.a,{staticClass:"px-2",attrs:{"x-small":"",dark:"",color:"cyan lighten-2"}},[t._v("transcript")]):t._e()],1)]):t._e(),t._v(" "),e("tr",[e("td",{staticClass:"caption py-1 pr-1"},[e("small",[t._v("Refer:")])]),t._v(" "),e("td",{staticClass:"caption font-weight-bold black--text"},[t._v(t._s(t.my_refer.body))])]),t._v(" "),t.my_refer.appendices.length?e("tr",[e("td",{staticClass:"caption py-1 pr-1"},[e("small",[t._v("Appendices:")])]),t._v(" "),e("td",t._l(t.my_refer.appendices,(function(r){return e(n.a,{attrs:{"x-small":"",color:"cyan lighten-2",rounded:""},on:{click:function(e){t.mediaDownload("refer-appendix",r.id,r.file_url.substr(13))}}},[t._v(t._s(r.file_url.substr(13)))])})),1)]):t._e()]):t._e(),t._v(" "),t.my_refer?e("div",{staticClass:"text-center mt-8"},[e("img",{staticStyle:{width:"80%","max-width":"300px"},attrs:{src:r(743),alt:"line"}}),t._v(" "),t.letter.pdf_url&&!t.letter.user?e("p",{staticClass:"orange--text mt-8"},[e(m.a,{attrs:{color:"orange"}},[t._v("mdi-alert-circle-outline")]),t._v(" "),e("b",[t._v("Before any refer, \"sign' the letter to prevent possible editing")])],1):t._e()]):e(d.a,{attrs:{"x-small":""}},[t._v("You are not in then circulation of this letter")])],1)],1),t._v(" "),e(o.a,{staticClass:"rounded-lg mt-6",attrs:{flat:"",outlined:""}},[e(c.c,{staticClass:"teal lighten-4 caption py-2 d-flex justify-space-between"},[e("small",[t._v(t._s(t.letter.refers.length)+" refer")]),t._v(" "),e("b",[t._v("Refer Circulation")]),t._v(" "),e(n.a,{attrs:{small:"",icon:"",outlined:"",color:"teal",title:"Tree of Refer",loading:t.processing},on:{click:t.loadLetterReferTree}},[e(m.a,{attrs:{small:""}},[t._v("mdi-file-tree mdi-flip-h")])],1)],1),t._v(" "),e(c.b,{staticClass:"pt-4"},[e(x.a,{attrs:{dense:""}},[e("thead",[e("tr",[e("th",{staticClass:"caption text-center"},[e("small")]),t._v(" "),e("th",{staticClass:"caption text-center"},[e("small",[t._v("from")])]),t._v(" "),e("th",{staticClass:"caption text-center"},[e("small",[t._v("date")])]),t._v(" "),e("th",{staticClass:"caption text-center"},[e("small",[t._v("to")])]),t._v(" "),e("th",{staticClass:"caption text-center"},[e("small",[t._v("body")])]),t._v(" "),e("th",{staticClass:"caption text-center"},[e("small")])])]),t._v(" "),e("tbody",t._l(t.letter.refers,(function(r,l){return e("tr",{style:{backgroundColor:r===t.my_refer?"lightcyan":""}},[e("td",{staticClass:"caption grey--text"},[t._v(t._s(l+1))]),t._v(" "),e("td",{staticClass:"caption",style:r.user_id===t.CurrentUser.id||r.sender_user_id===t.CurrentUser.id?"cursor: pointer":"",on:{click:function(e){r.user_id!==t.CurrentUser.id&&r.sender_user_id!==t.CurrentUser.id||t.$router.push("/letter/ref"+r.id)}}},[e("div",[t._v(t._s(r.sender_user))]),t._v(" "),e("div",{staticClass:"grey--text",staticStyle:{"margin-top":"-5px"}},[e("small",[t._v(t._s(r.sender_post))])])]),t._v(" "),e("td",{staticClass:"caption",style:r.user_id===t.CurrentUser.id||r.sender_user_id===t.CurrentUser.id?"cursor: pointer":"",on:{click:function(e){r.user_id!==t.CurrentUser.id&&r.sender_user_id!==t.CurrentUser.id||t.$router.push("/letter/ref"+r.id)}}},[e("div",{staticClass:"text-center"},[e("small",[t._v(t._s(r.time.substr(0,10)))])]),t._v(" "),e("div",{staticClass:"text-center grey--text",staticStyle:{"margin-top":"-5px"}},[e("small",[t._v(t._s(r.time.substr(11,5)))])])]),t._v(" "),e("td",{staticClass:"caption",style:r.user_id===t.CurrentUser.id||r.sender_user_id===t.CurrentUser.id?"cursor: pointer":"",on:{click:function(e){r.user_id!==t.CurrentUser.id&&r.sender_user_id!==t.CurrentUser.id||t.$router.push("/letter/ref"+r.id)}}},[e("div",{staticClass:"d-flex"},[e("div",{staticClass:"my-auto"},[e("div",[t._v(t._s(r.user))]),t._v(" "),e("div",{staticClass:"grey--text",staticStyle:{"margin-top":"-5px"}},[e("small",[t._v(t._s(r.post))])])]),t._v(" "),r.seen_time?e($.a,{attrs:{right:"",color:"grey lighten-1"},scopedSlots:t._u([{key:"activator",fn:function(r){var n=r.on;return[e(m.a,t._g({staticClass:"my-auto ml-2",attrs:{small:"",color:"grey lighten-1"}},n),[t._v("mdi-eye")])]}}],null,!0)},[t._v(" "),e("div",{staticClass:"caption black--text text-center"},[e("small",[t._v(t._s(r.seen_time.substr(0,10))),e("br"),t._v(t._s(r.seen_time.substr(11,5)))])])]):t._e(),t._v(" "),r.trashed?e($.a,{attrs:{right:"",color:"grey lighten-1"},scopedSlots:t._u([{key:"activator",fn:function(r){var n=r.on;return[e(m.a,t._g({staticClass:"my-auto ml-2",attrs:{small:"",color:"grey lighten-1"}},n),[t._v("mdi-trash-can-outline")])]}}],null,!0)},[t._v(" "),e("div",{staticClass:"caption black--text text-center"},[e("small",[t._v("Removed")])])]):t._e(),t._v(" "),r.archived?e($.a,{attrs:{right:"",color:"grey lighten-1"},scopedSlots:t._u([{key:"activator",fn:function(r){var n=r.on;return[e(m.a,t._g({staticClass:"my-auto ml-2",attrs:{small:"",color:"grey lighten-1"}},n),[t._v("mdi-archive-outline")])]}}],null,!0)},[t._v(" "),e("div",{staticClass:"caption black--text text-center"},[e("small",[t._v("Archived")])])]):t._e()],1)]),t._v(" "),e("td",{staticClass:"caption font-weight-bold"},[t._v(t._s(r.body))]),t._v(" "),e("td",[e("div",{staticClass:"caption d-flex justify-space-between"},[e("div",{staticClass:"my-auto"},t._l(r.appendices,(function(r){return e(n.a,{staticClass:"ml-1",attrs:{"x-small":"",color:"cyan lighten-3",rounded:""},on:{click:function(e){t.mediaDownload("refer-appendix",r.id,r.file_url.substr(13))}}},[t._v(t._s(r.file_url.substr(13)))])})),1),t._v(" "),e("div",{staticClass:"my-auto"},["immediate"===r.urgency?e(d.a,{attrs:{"x-small":"",dark:"",color:"pink lighten-2"}},[t._v("immediate")]):"urgent"===r.urgency?e(d.a,{attrs:{"x-small":"",dark:"",color:"orange lighten-1"}},[t._v("urgent")]):t._e(),t._v(" "),r.confidential?e(d.a,{attrs:{"x-small":"",dark:"",color:"pink lighten-2"}},[t._v("confidential")]):t._e(),t._v(" "),r.transcript?e(m.a,{attrs:{color:"cyan",title:"transcript"}},[t._v("mdi-content-copy mdi-18px")]):t._e()],1)])])])})),0)])],1)],1)],1),t._v(" "),e("vh2p",{ref:"vh2p",attrs:{"enable-download":!1,"manual-pagination":!0,"pdf-format":"a4","pdf-orientation":"landscape","preview-modal":!0,"pdf-quality":2}},[e("section",{attrs:{slot:"pdf-content"},slot:"pdf-content"},[e("div",{staticStyle:{margin:"20px",padding:"10px 20px 10px 20px",border:"thin solid grey","font-family":"dirooz,serif","font-size":"small",width:"285mm","border-radius":"15px"}},[e("table",{staticStyle:{width:"100%",margin:"20px 0"}},[e("tr",[e("td"),t._v(" "),e("td",{staticStyle:{width:"100px"}},[e("div",[e("small",{staticStyle:{color:"grey","margin-right":"5px"}},[t._v("No: ")]),t._v(" "),e("b",[t._v(t._s(t.letter.id))])]),t._v(" "),e("div",[e("small",{staticStyle:{color:"grey","margin-right":"8px"}},[t._v("Date: ")]),t._v(" "),e("b",[t._v(t._s(t.letter.date))])])])])]),t._v(" "),e("div",{staticStyle:{"margin-top":"10px","line-height":"30px"},domProps:{innerHTML:t._s(t.letter.body)}}),t._v(" "),e(y.a,{staticStyle:{margin:"10px 0"}},[e(_.a),t._v(" "),e(_.a,{staticStyle:{"text-align":"center"}},[e("b",[t._v(t._s(t.letter.user))]),e("br"),t._v(" "),e("small",{staticStyle:{color:"grey"}},[t._v(t._s(t.letter.post))]),e("br"),t._v(" "),t.letter.sign_url?e("img",{staticStyle:{height:"80px"},attrs:{src:t.MediaUrl+t.letter.sign_url,alt:"sign"}}):e(d.a,{staticClass:"mx-auto my-2",attrs:{"x-small":""}},[t._v("No Signature")])],1)],1)],1)])])],1),t._v(" "),t.my_refer?e(f.a,{attrs:{width:"600",scrollable:"",persistent:""},model:{value:t.dialog_refer,callback:function(e){t.dialog_refer=e},expression:"dialog_refer"}},[e("ReferModal",{ref:"refer_modal",attrs:{ids:[t.my_refer.id],reply_me:!0,is_in_inbox:t.my_refer&&t.my_refer.user_id===t.CurrentUser.id&&!t.my_refer.trashed&&!t.my_refer.archived},on:{closeModal:t.closeReferModal}})],1):t._e(),t._v(" "),e(f.a,{attrs:{width:"80%",scrollable:""},model:{value:t.dialog_refer_tree,callback:function(e){t.dialog_refer_tree=e},expression:"dialog_refer_tree"}},[e(o.a,[e(c.c,{staticClass:"teal lighten-4 font-weight-bold"},[e("small",{staticClass:"mx-auto"},[t._v("Referral Tree")])]),t._v(" "),e(c.b,{staticClass:"pt-4"},[e("org-chart",{staticStyle:{height:"95%"},attrs:{datasource:t.refer_tree},scopedSlots:t._u([{key:"default",fn:function(data){var r;return[e(o.a,{attrs:{title:null===(r=data.nodeData.seen_time)||void 0===r?void 0:r.substr(0,16).replaceAll("T"," ")}},[e(c.c,{staticClass:"cyan lighten-3 px-1 py-0 caption font-weight-bold",class:data.nodeData.seen_time?"cyan":"orange"},[e("small",{staticClass:"mx-auto"},[t._v(t._s(data.nodeData.user))])]),t._v(" "),e(c.b,{staticClass:"caption font-weight-bold py-1 px-0"},[e("small",[t._v(t._s(data.nodeData.post))])])],1)]}}])})],1)],1)],1),t._v(" "),t.letter.user?t._e():e(f.a,{attrs:{width:"800",persistent:""},model:{value:t.editing.dialog,callback:function(e){t.$set(t.editing,"dialog",e)},expression:"editing.dialog"}},[e(o.a,[e(c.c,{staticClass:"teal lighten-4 d-flex justify-space-between"},[e("div",{staticStyle:{width:"400px"}},[e(w.a,{attrs:{dense:"",solo:"",color:"teal",label:"Title","hide-details":""},model:{value:t.editing.title,callback:function(e){t.$set(t.editing,"title",e)},expression:"editing.title"}})],1),t._v(" "),e("div",[e(l.a,{attrs:{dense:"",rounded:"",mandatory:"",color:"info"},model:{value:t.editing.type,callback:function(e){t.$set(t.editing,"type",e)},expression:"editing.type"}},[e(n.a,{staticClass:"caption text-normal",attrs:{small:"",width:"80",disabled:t.editing.loading,value:"text"}},[t._v("Internal")]),t._v(" "),e(n.a,{staticClass:"caption text-normal",attrs:{small:"",width:"80",disabled:t.editing.loading,value:"pdf"}},[t._v("External")])],1)],1)]),t._v(" "),e(c.b,{staticClass:"pt-4"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"text"===t.editing.type,expression:"editing.type==='text'"}]},[e("ckeditor",{staticStyle:{border:"lightgray thin solid","min-height":"350px","line-height":"30px"},attrs:{editor:t.editor,config:t.editorConfig},on:{ready:t.onReady},model:{value:t.editing.body,callback:function(e){t.$set(t.editing,"body",e)},expression:"editing.body"}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"pdf"===t.editing.type,expression:"editing.type==='pdf'"}],staticClass:"pa-4",staticStyle:{border:"lightgray thin solid","min-height":"390px"}},[e(h.a,{staticClass:"mb-4",attrs:{dense:"",solo:"","hide-details":"","show-size":"","small-chips":"",accept:"application/pdf",color:"teal",label:"just pdf file"},model:{value:t.editing.file,callback:function(e){t.$set(t.editing,"file",e)},expression:"editing.file"}}),t._v(" "),e(w.a,{attrs:{dense:"",solo:"","hide-details":"",color:"teal",label:"Sender Organization"},model:{value:t.editing.external_sender,callback:function(e){t.$set(t.editing,"external_sender",e)},expression:"editing.external_sender"}}),t._v(" "),t.letter.pdf_url?e("p",{staticClass:"orange--text mt-8"},[e(m.a,{attrs:{color:"orange"}},[t._v("mdi-alert-circle-outline")]),t._v(" "),e("b",[t._v("if Attached new appendix, former file will be overwritten")])],1):t._e()],1)]),t._v(" "),e(c.a,{staticClass:"teal lighten-4 d-flex justify-space-around"},[e(n.a,{staticClass:"caption rounded-lg text-normal",attrs:{small:"",dark:"",color:"teal lighten-1",width:"100",loading:t.editing.loading},on:{click:t.saveLetter}},[t._v("Save")]),t._v(" "),e(n.a,{staticClass:"caption rounded-lg text-normal",attrs:{small:"",dark:"",color:"teal lighten-1",width:"100",loading:t.editing.loading},on:{click:function(e){t.editing.dialog=!1}}},[t._v("Ignore")])],1)],1)],1),t._v(" "),e(f.a,{attrs:{width:"500",scrollable:""},model:{value:t.related_letters.dialog,callback:function(e){t.$set(t.related_letters,"dialog",e)},expression:"related_letters.dialog"}},[e(o.a,{attrs:{loading:t.related_letters.loading}},[e(c.c,{staticClass:"teal lighten-4 font-weight-bold"},[e("small",[t._v("New Related Letter")])]),t._v(" "),e(c.b,{staticClass:"pt-4"},[e(w.a,{staticClass:"rounded-10 mb-3",attrs:{dense:"",outlined:"",clearable:"","hide-details":"",label:"search with title and no...",disabled:t.related_letters.loading,autofocus:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.relatedLetterSearch.apply(null,arguments)},"click:clear":function(e){t.related_letters.list=[]}},model:{value:t.related_letters.q,callback:function(e){t.$set(t.related_letters,"q",e)},expression:"related_letters.q"}}),t._v(" "),e(x.a,{attrs:{dense:""}},[e("tbody",t._l(t.related_letters.list,(function(r){return e("tr",[e("td",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.addRelation(r.id)}}},[t._v(t._s(r.id)+" - "+t._s(r.title))])])})),0)]),t._v(" "),e(v.a,{directives:[{name:"show",rawName:"v-show",value:t.related_letters.count>10,expression:"related_letters.count > 10"}],attrs:{color:"teal lighten-3",length:Math.ceil(t.related_letters.count/10),"total-visible":"9"},on:{input:t.relatedLetterSearch},model:{value:t.related_letters.page,callback:function(e){t.$set(t.related_letters,"page",e)},expression:"related_letters.page"}})],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{ReferModal:r(723).default})}}]);